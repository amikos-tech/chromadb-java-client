package tech.amikos.chromadb;

import org.apache.commons.io.FileUtils;
import org.junit.Test;

import java.util.Arrays;
import java.util.List;

import static org.junit.Assert.*;

public class TestDefaultEmbeddingFunction {
    // this represents the output of sentence-transformers/all-MiniLM-L6-v2 for "Hello, my name is John. I am a Data Scientist.", "Hello, I am Jane and I am an ML researcher."
    private static float[][] groundThruth = {{-0.09585458785295486f,
            0.00948028638958931f,
            0.06449528783559799f,
            0.06595586985349655f,
            -0.04144003242254257f,
            -0.10210221260786057f,
            0.041818294674158096f,
            -0.004058007150888443f,
            -0.030316634103655815f,
            0.02270486019551754f,
            -0.035775184631347656f,
            -0.019363753497600555f,
            0.05840573087334633f,
            -0.019858120009303093f,
            -0.03416302800178528f,
            0.023755116388201714f,
            -0.04887963458895683f,
            -0.023338720202445984f,
            -0.03097701258957386f,
            -0.06726820021867752f,
            -0.047849390655756f,
            0.002262122929096222f,
            -0.050954557955265045f,
            -0.0704192966222763f,
            0.03851667791604996f,
            0.05452864617109299f,
            0.0472191721200943f,
            0.05565935745835304f,
            -0.06013466790318489f,
            -0.060048338025808334f,
            -0.06324896961450577f,
            -0.004660584963858128f,
            0.0833488330245018f,
            0.06518704444169998f,
            0.061783649027347565f,
            -0.0057580843567848206f,
            -0.06831730902194977f,
            -0.0027126308996230364f,
            0.0032052304595708847f,
            0.004442276898771524f,
            0.02566530555486679f,
            -0.06587797403335571f,
            0.04000983387231827f,
            0.020301034674048424f,
            -0.042582057416439056f,
            -0.034585196524858475f,
            0.01486957911401987f,
            0.006351375486701727f,
            0.012819512747228146f,
            0.016794603317975998f,
            -0.1442369818687439f,
            -0.036635056138038635f,
            -0.012132037431001663f,
            0.054017357528209686f,
            0.03453433886170387f,
            -0.03326355293393135f,
            0.03831372782588005f,
            0.03907116502523422f,
            -0.04063969478011131f,
            -0.011150147765874863f,
            -0.06000356003642082f,
            -0.012438077479600906f,
            -0.1148035079240799f,
            0.05022793635725975f,
            0.08595263212919235f,
            0.019273564219474792f,
            -0.03813284635543823f,
            0.04905250295996666f,
            0.021730052307248116f,
            -0.06437823921442032f,
            -0.06207166984677315f,
            -0.010931634344160557f,
            -0.07005178183317184f,
            0.048188939690589905f,
            -0.021501995623111725f,
            -0.01519235409796238f,
            -0.01088312640786171f,
            0.036744046956300735f,
            0.11533796042203903f,
            0.04394731670618057f,
            0.022351941093802452f,
            -0.0694778710603714f,
            -0.14287206530570984f,
            0.002787005854770541f,
            -0.02520938776433468f,
            0.018195422366261482f,
            -0.03290892764925957f,
            0.09594959020614624f,
            -0.0790214091539383f,
            -0.06380059570074081f,
            0.0020406043622642756f,
            -0.0022298344410955906f,
            0.0011398063506931067f,
            0.08340359479188919f,
            -0.09954331070184708f,
            -0.024701174348592758f,
            0.019631244242191315f,
            -0.006075597368180752f,
            -0.04857270419597626f,
            0.036346402019262314f,
            -0.011533500626683235f,
            0.03277066349983215f,
            0.022185729816555977f,
            0.10524636507034302f,
            0.0022879349999129772f,
            0.01772546023130417f,
            -0.04884761571884155f,
            0.05326351150870323f,
            0.03047122433781624f,
            -0.08757409453392029f,
            -0.030721280723810196f,
            -0.00772859575226903f,
            -0.08797163516283035f,
            -0.028308028355240822f,
            -0.001540705212391913f,
            -0.06213157996535301f,
            -0.04336702451109886f,
            0.05428041145205498f,
            0.026199134066700935f,
            -0.0470283217728138f,
            0.028990667313337326f,
            0.05769278481602669f,
            -0.08303508162498474f,
            -0.05381003022193909f,
            0.036160971969366074f,
            0.058339837938547134f,
            -0.09613247960805893f,
            -6.687360178521131e-33f,
            0.03682004287838936f,
            0.043789900839328766f,
            0.10437802970409393f,
            0.15669868886470795f,
            -0.06030746549367905f,
            -0.0011067378800362349f,
            -0.10755843669176102f,
            -0.0020333367865532637f,
            -0.03200452774763107f,
            0.010678966529667377f,
            -0.000848894938826561f,
            0.04295719414949417f,
            0.019144756719470024f,
            -0.009240921586751938f,
            -0.07697387784719467f,
            0.031998272985219955f,
            0.012779496610164642f,
            0.006133145187050104f,
            -0.026671690866351128f,
            0.052042942494153976f,
            -0.002637297147884965f,
            -0.04257839545607567f,
            0.030323265120387077f,
            0.04461345449090004f,
            0.08032087981700897f,
            -0.038311731070280075f,
            0.02064959704875946f,
            -0.08821066468954086f,
            0.15501201152801514f,
            0.005460179410874844f,
            0.012035267427563667f,
            0.01326702255755663f,
            0.006971028633415699f,
            -0.03180614486336708f,
            0.07937445491552353f,
            -0.027660902589559555f,
            -0.0010033247526735067f,
            -0.07399091124534607f,
            0.005404886789619923f,
            0.016363127157092094f,
            -0.037255868315696716f,
            0.03943704441189766f,
            0.03164369985461235f,
            0.025043606758117676f,
            -0.0387364886701107f,
            -0.04596373811364174f,
            0.08971153199672699f,
            0.009558212012052536f,
            0.061766281723976135f,
            -0.00535972835496068f,
            -0.06706439703702927f,
            0.008159090764820576f,
            -0.06945706158876419f,
            0.03745569661259651f,
            -0.016799751669168472f,
            0.05164659395813942f,
            0.048563942313194275f,
            -0.0007197027443908155f,
            0.00350027228705585f,
            0.049179140478372574f,
            -0.10629745572805405f,
            0.06949912756681442f,
            0.004620889667421579f,
            0.024071011692285538f,
            -0.01602218858897686f,
            0.005312735214829445f,
            -0.030950920656323433f,
            -0.003942802082747221f,
            0.09100464731454849f,
            0.08968598395586014f,
            0.026305897161364555f,
            -0.021082688122987747f,
            0.0569409541785717f,
            0.051254235208034515f,
            0.09538979083299637f,
            0.06134245917201042f,
            -0.04533593729138374f,
            0.015669571235775948f,
            -0.052699241787195206f,
            0.0024702614173293114f,
            -0.02752934768795967f,
            -0.017606819048523903f,
            0.02029530517756939f,
            -0.020326904952526093f,
            0.042705975472927094f,
            0.07871954143047333f,
            -0.0032613887451589108f,
            -0.08032066375017166f,
            0.025115517899394035f,
            -0.0027041647117584944f,
            -0.04574376717209816f,
            0.032349593937397f,
            0.02724195271730423f,
            0.01871751807630062f,
            -0.06770546734333038f,
            3.749572778469732e-33f,
            -0.031197205185890198f,
            0.02471674047410488f,
            0.025199811905622482f,
            0.02507738396525383f,
            0.07604343444108963f,
            -0.06405463814735413f,
            0.021355606615543365f,
            0.01512217242270708f,
            -0.011929183267056942f,
            0.026375196874141693f,
            0.006126232445240021f,
            -0.0052116625010967255f,
            0.036424219608306885f,
            -0.033887360244989395f,
            0.04992717504501343f,
            0.050488606095314026f,
            0.010197697207331657f,
            -0.02888398990035057f,
            -0.0836842805147171f,
            -0.015586711466312408f,
            -0.11193014681339264f,
            0.03552526235580444f,
            -0.08755801618099213f,
            -0.0011521631386131048f,
            0.05781976133584976f,
            -0.05618219077587128f,
            0.030507076531648636f,
            0.00858727004379034f,
            0.0405815914273262f,
            0.0014287643134593964f,
            -0.0647103562951088f,
            -0.004953945521265268f,
            -0.11465773731470108f,
            -0.05401500687003136f,
            -0.05764947831630707f,
            0.013947632163763046f,
            0.07131663709878922f,
            -0.09751860797405243f,
            0.02640238218009472f,
            -0.05058669671416283f,
            0.003804068546742201f,
            0.030711550265550613f,
            -0.02500280737876892f,
            0.007008112035691738f,
            -0.0016476899618282914f,
            -0.07471956312656403f,
            3.1293591746361926e-05f,
            0.03754337877035141f,
            -0.053971726447343826f,
            0.023011285811662674f,
            -0.03540029376745224f,
            0.009353957138955593f,
            0.023803526535630226f,
            -0.07089712470769882f,
            0.0332937054336071f,
            0.038956545293331146f,
            0.10356861352920532f,
            0.020697198808193207f,
            -0.0017958646640181541f,
            0.06905552744865417f,
            -0.02837231568992138f,
            -0.011508774012327194f,
            0.02831237018108368f,
            0.11676878482103348f,
            0.008890269324183464f,
            -0.014236279763281345f,
            0.008686048910021782f,
            -0.0027900345157831907f,
            -0.01813756488263607f,
            -0.08539675176143646f,
            0.09203267842531204f,
            -0.015694696456193924f,
            0.01952199824154377f,
            -0.059190526604652405f,
            0.012267987243831158f,
            -0.036826860159635544f,
            -0.03677833825349808f,
            0.0064687347039580345f,
            -0.0672142431139946f,
            0.0897166058421135f,
            0.03025389276444912f,
            0.011798573657870293f,
            0.019593898206949234f,
            0.015443249605596066f,
            0.01595941185951233f,
            0.015705550089478493f,
            -0.0004455214075278491f,
            0.02854067087173462f,
            -0.04562589153647423f,
            -0.047964513301849365f,
            -0.12343782931566238f,
            -0.014698817394673824f,
            -0.03646207973361015f,
            -0.006195136345922947f,
            -0.04197908192873001f,
            -2.204232885105739e-08f,
            0.014136684127151966f,
            -0.061789777129888535f,
            0.046023767441511154f,
            0.0072265504859387875f,
            0.004496420733630657f,
            0.04225821793079376f,
            -0.05978027358651161f,
            0.06642647832632065f,
            -0.0011911533074453473f,
            -0.011026511900126934f,
            0.07080002129077911f,
            0.022587932646274567f,
            -0.05675440654158592f,
            -0.01975814253091812f,
            0.08161557465791702f,
            -0.005019841715693474f,
            0.044190991669893265f,
            -0.0009667372796684504f,
            -0.01896727830171585f,
            0.028884947299957275f,
            0.032576825469732285f,
            0.0770535096526146f,
            -0.046847864985466f,
            0.07227548956871033f,
            0.09427182376384735f,
            0.0531928576529026f,
            0.08638159930706024f,
            0.10740622878074646f,
            -0.09499743580818176f,
            0.025405744090676308f,
            -0.01263652928173542f,
            0.04843660816550255f,
            -0.007302490994334221f,
            0.048734281212091446f,
            -0.015140815638005733f,
            -0.10783609747886658f,
            0.05389820411801338f,
            0.024867836385965347f,
            0.05159829556941986f,
            -0.008217083290219307f,
            -0.07178572565317154f,
            0.09328121691942215f,
            -0.023542558774352074f,
            0.05239303782582283f,
            -0.03273957967758179f,
            0.07256103307008743f,
            -0.024191774427890778f,
            -0.00945044495165348f,
            -0.014314060099422932f,
            0.017101649194955826f,
            -0.015191149897873402f,
            -0.029306570068001747f,
            0.06332913041114807f,
            0.030651697888970375f,
            0.10759934782981873f,
            -0.004157477058470249f,
            0.06462010741233826f,
            0.06584816426038742f,
            -0.04045629873871803f,
            -0.07335453480482101f,
            0.05981225520372391f,
            -0.05171000584959984f,
            -0.04719773307442665f,
            -0.033861324191093445f},
            {0.032470982521772385f,
                    -0.017813976854085922f,
                    0.09103047847747803f,
                    0.0662265345454216f,
                    -0.004986118525266647f,
                    -0.036341968923807144f,
                    0.004300299100577831f,
                    0.005200391635298729f,
                    -0.03274604678153992f,
                    -0.014939035288989544f,
                    0.01147277932614088f,
                    -0.0029152948409318924f,
                    -0.02211623452603817f,
                    -0.042097341269254684f,
                    -0.049638181924819946f,
                    0.09333044290542603f,
                    -0.020927147939801216f,
                    -0.026947692036628723f,
                    -0.12432024627923965f,
                    0.013082092627882957f,
                    -0.09639916568994522f,
                    -0.03806604444980621f,
                    -0.012412002310156822f,
                    0.0435180589556694f,
                    0.017384078353643417f,
                    -0.018446993082761765f,
                    0.05199646204710007f,
                    0.02032429352402687f,
                    0.0744006410241127f,
                    0.03578963130712509f,
                    -0.03855806216597557f,
                    0.022090259939432144f,
                    0.06836511194705963f,
                    0.06377742439508438f,
                    0.06869128346443176f,
                    0.05386146157979965f,
                    0.047937557101249695f,
                    -0.014405525289475918f,
                    0.042463596910238266f,
                    0.035660456866025925f,
                    0.01611713506281376f,
                    -0.09118328243494034f,
                    0.03768451139330864f,
                    -0.029440438374876976f,
                    -0.02313595451414585f,
                    -0.029354600235819817f,
                    0.009454349987208843f,
                    -0.004506702534854412f,
                    -0.02972273714840412f,
                    0.018433788791298866f,
                    -0.11473238468170166f,
                    -0.010125036351382732f,
                    -0.0013624498387798667f,
                    0.024189213290810585f,
                    0.023019906133413315f,
                    -0.04870212450623512f,
                    -0.011203262023627758f,
                    0.004811882507055998f,
                    0.005358981899917126f,
                    0.009688693098723888f,
                    -0.032397400587797165f,
                    0.00649231718853116f,
                    -0.0943230614066124f,
                    0.05091932415962219f,
                    0.04015204682946205f,
                    0.006206254940479994f,
                    -0.12947048246860504f,
                    0.03915683180093765f,
                    0.0038421349599957466f,
                    -0.05188129097223282f,
                    0.004851798061281443f,
                    -0.038142792880535126f,
                    -0.08346209675073624f,
                    0.110108382999897f,
                    0.01975100301206112f,
                    0.024924926459789276f,
                    0.10811963677406311f,
                    -0.03592298552393913f,
                    0.11878448724746704f,
                    0.01458478532731533f,
                    0.03076137788593769f,
                    -0.0074920919723808765f,
                    -0.04760413616895676f,
                    0.015651658177375793f,
                    -0.07754474878311157f,
                    -0.07776712626218796f,
                    -0.05155258998274803f,
                    0.08887834846973419f,
                    0.019695332273840904f,
                    0.004609257448464632f,
                    -0.03667515516281128f,
                    0.026315441355109215f,
                    -0.036759596318006516f,
                    0.025319784879684448f,
                    -0.03272395208477974f,
                    -0.01455981470644474f,
                    0.008798807859420776f,
                    -0.027347559109330177f,
                    -0.004474400542676449f,
                    0.08458873629570007f,
                    -0.022725073620676994f,
                    0.08203046023845673f,
                    -0.009424270130693913f,
                    0.05794243514537811f,
                    -0.027780253440141678f,
                    -0.039574600756168365f,
                    -0.03985302895307541f,
                    0.03268566355109215f,
                    0.017434800043702126f,
                    -0.07331137359142303f,
                    0.04008691385388374f,
                    -0.049156155437231064f,
                    -0.041357241570949554f,
                    0.015092026442289352f,
                    0.042833536863327026f,
                    -0.09655860811471939f,
                    -0.009191427379846573f,
                    0.05041028931736946f,
                    0.025020930916070938f,
                    -0.0010903703514486551f,
                    -0.01153971441090107f,
                    0.055329855531454086f,
                    -0.07093106955289841f,
                    -0.10202781111001968f,
                    -0.05860423669219017f,
                    -0.03908321261405945f,
                    -0.06963896006345749f,
                    -6.819881738212989e-33f,
                    -0.05034259706735611f,
                    0.046635307371616364f,
                    0.061453815549612045f,
                    0.1632499247789383f,
                    -0.04075726494193077f,
                    -0.022670969367027283f,
                    -0.006809735205024481f,
                    -0.032284870743751526f,
                    0.03480874374508858f,
                    -0.012414581142365932f,
                    -0.0071273562498390675f,
                    0.03807320073246956f,
                    -0.006105185952037573f,
                    -0.022729644551873207f,
                    -0.061231229454278946f,
                    0.0619988888502121f,
                    0.05873256176710129f,
                    0.032221317291259766f,
                    -0.08261745423078537f,
                    0.022939501330256462f,
                    0.06733444333076477f,
                    -0.06015993282198906f,
                    0.021170560270547867f,
                    -0.054680775851011276f,
                    0.04987915977835655f,
                    -0.039290230721235275f,
                    0.04173582047224045f,
                    -0.06061732769012451f,
                    0.07556696981191635f,
                    0.01709105633199215f,
                    -0.01861475221812725f,
                    0.07065264135599136f,
                    -0.026991551741957664f,
                    -0.05504021421074867f,
                    0.002307836664840579f,
                    0.06408514827489853f,
                    0.03251758590340614f,
                    -0.08594448864459991f,
                    0.01902201771736145f,
                    0.03420829772949219f,
                    -0.04273582994937897f,
                    0.03365328162908554f,
                    0.15104778110980988f,
                    -0.024075830355286598f,
                    -0.0030312633607536554f,
                    0.03414997085928917f,
                    0.021509287878870964f,
                    -0.08260119706392288f,
                    0.05932952091097832f,
                    -0.022917667403817177f,
                    -0.10696452856063843f,
                    0.003822541097179055f,
                    -0.05484633520245552f,
                    -0.0009232646552845836f,
                    0.04648015275597572f,
                    0.028328044340014458f,
                    -0.011910024099051952f,
                    0.07007365673780441f,
                    -0.0032808773685246706f,
                    0.025030862540006638f,
                    -0.0588592030107975f,
                    0.032608259469270706f,
                    -0.03625897690653801f,
                    0.0575789213180542f,
                    0.0219504963606596f,
                    -0.00031610886799171567f,
                    0.008611606433987617f,
                    0.005103116389364004f,
                    0.0544932521879673f,
                    0.02514653280377388f,
                    -0.01069401390850544f,
                    0.040063243359327316f,
                    0.0030146585777401924f,
                    -0.03559613227844238f,
                    -0.042914632707834244f,
                    0.03892488405108452f,
                    -0.022482896223664284f,
                    -0.006886311341077089f,
                    0.060940083116292953f,
                    -0.007247471250593662f,
                    -0.018828019499778748f,
                    0.02945023402571678f,
                    -0.04034523665904999f,
                    -0.027738675475120544f,
                    0.011778023093938828f,
                    0.053314242511987686f,
                    -0.012108864262700081f,
                    -0.003313975175842643f,
                    0.06962978094816208f,
                    -0.025122152641415596f,
                    -0.06273254752159119f,
                    0.0005014355410821736f,
                    0.006060570478439331f,
                    0.013680621981620789f,
                    -0.12261677533388138f,
                    3.233225129927534e-33f,
                    -0.0589633509516716f,
                    0.040580566972494125f,
                    0.019625846296548843f,
                    0.02602434903383255f,
                    0.06306370347738266f,
                    0.009427609853446484f,
                    -0.00481993006542325f,
                    -0.003048526355996728f,
                    -0.05872064456343651f,
                    0.12210481613874435f,
                    -0.0001253927475772798f,
                    -0.07909934222698212f,
                    -0.02846868336200714f,
                    0.05321290343999863f,
                    -0.06128118187189102f,
                    -0.01313082966953516f,
                    0.061504822224378586f,
                    -0.050759200006723404f,
                    -0.06360293179750443f,
                    -0.009319847449660301f,
                    -0.08136218786239624f,
                    0.06484118849039078f,
                    -0.06656011939048767f,
                    0.052685387432575226f,
                    0.0656621903181076f,
                    -0.01696452498435974f,
                    0.02894679643213749f,
                    0.010055086575448513f,
                    -0.03425998613238335f,
                    -0.023136617615818977f,
                    0.013063939288258553f,
                    -0.0001964945695362985f,
                    -0.07823090255260468f,
                    -0.049299705773591995f,
                    -0.01307445764541626f,
                    0.07255972176790237f,
                    0.11026933789253235f,
                    -0.13309241831302643f,
                    0.03477446362376213f,
                    -0.031274206936359406f,
                    0.005546981003135443f,
                    -0.014786618761718273f,
                    -0.04382247105240822f,
                    -0.022944122552871704f,
                    -0.005763736087828875f,
                    -0.02803990989923477f,
                    0.03973599895834923f,
                    -0.06982606649398804f,
                    0.055903855711221695f,
                    -0.01849217340350151f,
                    -0.029178695753216743f,
                    -0.010836802423000336f,
                    -0.03435875475406647f,
                    -0.0006889880751259625f,
                    -0.02007262594997883f,
                    -0.039470091462135315f,
                    0.08727303892374039f,
                    -0.05273575335741043f,
                    -0.034710273146629333f,
                    0.06429289281368256f,
                    -0.0441647432744503f,
                    0.002606051042675972f,
                    -0.041703928261995316f,
                    0.08004797995090485f,
                    -0.022487612441182137f,
                    -0.03471028432250023f,
                    -0.0008381651132367551f,
                    0.0909014567732811f,
                    -0.06743320822715759f,
                    -0.07035818696022034f,
                    0.08347608149051666f,
                    0.006671304348856211f,
                    0.009866351261734962f,
                    -0.03535081073641777f,
                    -0.1096097007393837f,
                    -0.020150264725089073f,
                    0.030442936345934868f,
                    -0.08029218018054962f,
                    0.00021869537886232138f,
                    0.008556777611374855f,
                    0.021512867882847786f,
                    -0.10086994618177414f,
                    0.06591685861349106f,
                    0.02657444402575493f,
                    0.03068164363503456f,
                    0.00835234671831131f,
                    -0.01443871483206749f,
                    0.026387102901935577f,
                    -0.057937491685152054f,
                    -0.061116188764572144f,
                    -0.07227037847042084f,
                    -0.06715630739927292f,
                    -0.029829327017068863f,
                    -0.04155528545379639f,
                    -0.01873711682856083f,
                    -2.313823621591382e-08f,
                    -0.04755893349647522f,
                    -0.011731435544788837f,
                    0.03431084752082825f,
                    0.04400825873017311f,
                    -0.060959603637456894f,
                    0.09364251792430878f,
                    -0.14093442261219025f,
                    0.0018414495280012488f,
                    0.006476705428212881f,
                    0.04462616890668869f,
                    -0.02774716541171074f,
                    -0.040246184915304184f,
                    -0.0867241695523262f,
                    -0.0030751472804695368f,
                    0.06490536034107208f,
                    0.001515702810138464f,
                    0.020403634756803513f,
                    0.0036018516402691603f,
                    0.003295356407761574f,
                    -0.01664314605295658f,
                    0.05650820955634117f,
                    0.0651976615190506f,
                    0.017309093847870827f,
                    -0.008219453506171703f,
                    0.045807670801877975f,
                    0.028303757309913635f,
                    0.0075932214967906475f,
                    0.10886969417333603f,
                    -0.09187823534011841f,
                    -0.01187183428555727f,
                    -0.08677797019481659f,
                    0.06410083174705505f,
                    -0.048447176814079285f,
                    0.03530236706137657f,
                    -0.006899421568959951f,
                    -0.057062678039073944f,
                    0.0431440994143486f,
                    0.00041753044934011996f,
                    0.006904853507876396f,
                    -0.007148951292037964f,
                    -0.01590801402926445f,
                    0.057071223855018616f,
                    -0.07607273757457733f,
                    0.020105505362153053f,
                    0.04024725407361984f,
                    0.08025668561458588f,
                    0.02379310131072998f,
                    -0.040123388171195984f,
                    -0.00920546893030405f,
                    0.05223090201616287f,
                    0.041356317698955536f,
                    -0.02788914553821087f,
                    0.19586071372032166f,
                    0.0018509950023144484f,
                    0.05987996608018875f,
                    0.046917349100112915f,
                    0.02290949784219265f,
                    0.04779403284192085f,
                    -0.029831457883119583f,
                    -0.013816923834383488f,
                    0.12134341895580292f,
                    -0.0315195731818676f,
                    -0.0016703865258023143f,
                    -0.05963480845093727f}};

    public static boolean compareFloatArrays(Float[] array1, float[] array2, float marginOfError) {
        if (array1.length != array2.length) {
            return false; // Arrays are of different lengths
        }

        for (int i = 0; i < array1.length; i++) {
            if (Math.abs(array1[i] - array2[i]) > marginOfError) {
                System.out.println("Difference at index " + i + ": " + Math.abs(array1[i] - array2[i]) + " > " + marginOfError);
                System.out.println("Expected: " + array2[i] + ", Actual: " + array1[i]);
                System.out.println("abs(expected - actual) / abs(expected): " + Math.abs(array2[i] - array1[i]) / Math.abs(array2[i]));
                return false; // Difference exceeds margin of error
            }
        }

        return true; // All elements are within the margin of error
    }

    @Test
    public void testDefaultEmbeddingFunction() throws Exception {
        EmbeddingFunction ef = new DefaultEmbeddingFunction();
        List<List<Float>> result = ef.createEmbedding(Arrays.asList("Hello, my name is John. I am a Data Scientist.", "Hello, I am Jane and I am an ML researcher."));
        assertEquals(2, result.size());
        assertEquals(384, result.get(0).size());
        for (int i = 0; i < result.size(); i++) {
            assertTrue(compareFloatArrays(result.get(i).stream().mapToDouble(Float::doubleValue).mapToObj(d -> (float) d).toArray(Float[]::new), groundThruth[i], 1e-5f));
        }
    }

    @Test
    public void testDownloadModel() throws Exception {
        // delete directory if exists
        if (DefaultEmbeddingFunction.MODEL_CACHE_DIR.toFile().exists()) {
            FileUtils.deleteDirectory(DefaultEmbeddingFunction.MODEL_CACHE_DIR.toFile());
        }
        EmbeddingFunction ef = new DefaultEmbeddingFunction();

        assertTrue(DefaultEmbeddingFunction.MODEL_CACHE_DIR.toFile().exists());

    }


}
